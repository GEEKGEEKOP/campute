<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>تقویم فارسی سفارشی</title>
  <style>
    /* استایل تقویم */
    #calendarContainer {
      width: 300px;
      margin: 20px auto;
      text-align: center;
    }
    #monthYear {
      margin-bottom: 10px;
      font-size: 1.2em;
      font-weight: bold;
    }
    #calendar {
      width: 100%;
      border-collapse: collapse;
    }
    #calendar th, #calendar td {
      border: 1px solid #ccc;
      padding: 8px;
      height: 40px;
      vertical-align: middle;
    }
    #calendar th {
      background: #f2f2f2;
    }
    /* استایل روزهای علامت‌گذاری شده */
    .marked {
      background: #ffeb3b;
      cursor: pointer;
    }
    /* استایل روز امروز */
    .today {
      border: 2px solid red;
    }
    /* استایل modal */
    #modalOverlay {
      display: none;
      position: fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background: rgba(0,0,0,0.5);
      z-index: 100;
    }
    #modal {
      display: none;
      position: fixed;
      top: 50%;
      left:50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      z-index: 101;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    #modal button {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="calendarContainer">
    <h2 id="monthYear"></h2>
    <table id="calendar">
      <thead>
        <tr>
          <th>ش</th> <!-- شنبه -->
          <th>ی</th> <!-- یکشنبه -->
          <th>د</th> <!-- دوشنبه -->
          <th>س</th> <!-- سه‌شنبه -->
          <th>چ</th> <!-- چهارشنبه -->
          <th>پ</th> <!-- پنجشنبه -->
          <th>ج</th> <!-- جمعه -->
        </tr>
      </thead>
      <tbody id="calendarBody">
      </tbody>
    </table>
  </div>

  <!-- overlay و modal برای نمایش اطلاعات -->
  <div id="modalOverlay"></div>
  <div id="modal">
    <p id="modalContent"></p>
    <button onclick="closeModal()">بستن</button>
  </div>

<script src="https://unpkg.com/jalaali-js/dist/jalaali.min.js"></script>
  <!-- افزودن jalaali-js از jsDelivr (در صورت نامعتبر بودن CDN، می‌توانید فایل را به صورت محلی بارگذاری کنید) -->
  <script>
    /*
      در این اسکریپت:
      - با استفاده از jalaali-js تاریخ میلادی کنونی به شمسی تبدیل می‌شود.
      - تقویم ماه جاری (سال و ماه شمسی) ساخته شده و تعداد روزهای ماه بر اساس ماه و سال شمسی محاسبه می‌شود.
      - تاریخ شروع ماه (اولین روز ماه) با تبدیل به تاریخ میلادی و بررسی روز هفته محاسبه می‌شود.
      - تاریخ‌هایی که در آرایه markedDates تعریف شده‌اند با کلاس "marked" مشخص شده و رویداد کلیک به آن‌ها اضافه می‌شود.
      - در صورت تطابق تاریخ امروز نیز با کلاس "today" مشخص می‌شود.
    */
    
    // آرایه تاریخ‌های علامت‌گذاری شده (به فرمت "YYYY/MM/DD")
    const markedDates = ["1403/01/15", "1403/01/20", "1403/01/25"];

    // گرفتن تاریخ امروز میلادی و تبدیل به شمسی
    const todayGregorian = new Date();
    const todayJ = jalaali.toJalaali(
      todayGregorian.getFullYear(),
      todayGregorian.getMonth() + 1,
      todayGregorian.getDate()
    );
    // استفاده از ماه و سال جاری شمسی
    let currentYear = todayJ.jy;
    let currentMonth = todayJ.jm; // ماه از 1 تا 12

    function generateCalendar(year, month) {
      // تعیین تعداد روزهای ماه بر اساس ماه شمسی
      let daysInMonth;
      if (month <= 6) {
        daysInMonth = 31;
      } else if (month <= 11) {
        daysInMonth = 30;
      } else {
        daysInMonth = jalaali.isLeapJalaaliYear(year) ? 30 : 29;
      }
      
      // محاسبه روز هفته اولین روز ماه
      // تبدیل تاریخ شمسی (year, month, 1) به میلادی
      const gDate = jalaali.toGregorian(year, month, 1);
      const firstDayDate = new Date(gDate.gy, gDate.gm - 1, gDate.gd);
      // در جاوااسکریپت: 0 = یکشنبه، 6 = شنبه
      // چون در تقویم فارسی، شنبه اولین روز هفته است، باید تنظیم کنیم:
      let jsDay = firstDayDate.getDay(); // 0 (یکشنبه) تا 6 (شنبه)
      let startIndex = (jsDay + 1) % 7; // اگر jsDay=6 (شنبه) → startIndex=0
      
      // پاکسازی تقویم قدیمی
      const calendarBody = document.getElementById("calendarBody");
      calendarBody.innerHTML = "";

      // نمایش عنوان ماه و سال
      document.getElementById("monthYear").innerText =
        year + "/" + (month < 10 ? "0" + month : month);

      let row = document.createElement("tr");
      // ایجاد سلول‌های خالی برای روزهایی که قبل از اولین روز ماه هستند
      for (let i = 0; i < startIndex; i++) {
        let cell = document.createElement("td");
        cell.innerText = "";
        row.appendChild(cell);
      }
      // پر کردن سلول‌های روزهای ماه
      for (let day = 1; day <= daysInMonth; day++) {
        if (row.children.length === 7) {
          calendarBody.appendChild(row);
          row = document.createElement("tr");
        }
        let cell = document.createElement("td");
        cell.innerText = day;
        // فرمت‌دهی تاریخ به صورت "YYYY/MM/DD"
        let dayString = day < 10 ? "0" + day : day;
        let monthString = month < 10 ? "0" + month : month;
        let dateStr = year + "/" + monthString + "/" + dayString;

        // علامت‌گذاری تاریخ‌های موجود در آرایه markedDates
        if (markedDates.includes(dateStr)) {
          cell.classList.add("marked");
          cell.onclick = function() {
            openModal("رویداد ویژه برای تاریخ " + dateStr);
          }
        }

        // مشخص کردن امروز (اگر تاریخ با تاریخ امروز مطابقت داشته باشد)
        if (year === todayJ.jy && month === todayJ.jm && day === todayJ.jd) {
          cell.classList.add("today");
        }

        row.appendChild(cell);
      }
      // پر کردن سلول‌های خالی انتهای ردیف (در صورت نیاز)
      while (row.children.length < 7) {
        let cell = document.createElement("td");
        cell.innerText = "";
        row.appendChild(cell);
      }
      calendarBody.appendChild(row);
    }

    // تابع نمایش modal با محتوا
    function openModal(content) {
      document.getElementById("modalContent").innerText = content;
      document.getElementById("modalOverlay").style.display = "block";
      document.getElementById("modal").style.display = "block";
    }
    function closeModal() {
      document.getElementById("modalOverlay").style.display = "none";
      document.getElementById("modal").style.display = "none";
    }

    // تولید تقویم در بارگذاری صفحه
    window.onload = function() {
      generateCalendar(currentYear, currentMonth);
    }
  </script>
</body>
</html>

